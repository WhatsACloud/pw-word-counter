<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PW summary word counter</title>
  <style>
    body {
      background: #121212;
      color: #f0f0f0;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      padding: 2rem;
    }

    textarea {
      width: 100%;
      height: 200px;
      background: #1e1e1e;
      color: #fff;
      border: 1px solid #444;
      padding: 1rem;
      margin-bottom: 1rem;
      resize: vertical;
      font-family: monospace;
    }

    .stats {
      display: flex;
      gap: 2rem;
      margin-bottom: 1rem;
    }

    .stat-box {
      background: #1a1a1a;
      border: 1px solid #444;
      padding: 1rem;
      border-radius: 6px;
      flex: 1;
    }

    .outputs {
      display: flex;
      gap: 2rem;
    }

    .output-box {
      flex: 1;
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid #444;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      min-height: 300px;
    }

    button {
      background: #2196f3;
      border: none;
      padding: 0.75rem 1.5rem;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

  <h1>ðŸ§  Smart Text Cutter</h1>
  <textarea id="inputText" placeholder="Paste your text here..."></textarea>
  <button onclick="handleProcess()">Process</button>

  <div class="stats">
    <div class="stat-box" id="originalCount"><strong>Original Words:</strong> 0</div>
    <div class="stat-box" id="processedCount"><strong>Processed Words:</strong> 0</div>
    <div class="stat-box" id="cutCount"><strong>Cut Words:</strong> 0</div>
  </div>

  <div class="outputs">
    <div class="output-box" id="processedOutput"><strong>Processed Output...</strong></div>
    <div class="output-box" id="cutOutput"><strong>Cut Content...</strong></div>
  </div>

<script>
  function removeSpecialBrackets(text, removedLines) {
    return text.replace(/\(([^()]*)\)/g, (match, content) => {
      if (/^\w+$/.test(content)) return match;
      if (/,/.test(content) || /\b\d{4}\b/.test(content) || /fig\./i.test(content)) {
        removedLines.push(match);
        return "";
      }
      return match;
    });
  }

  function countWords(text) {
    return text.trim().split(/\s+/).filter(Boolean).length;
  }

  function processText(input) {
    const lines = input.split('\n');
    const removed = [];

    const keyword = "real-world problem or opportunity identified in project & rationale";
    let startIdx = lines.findIndex(l => l.trim().toLowerCase() === keyword);
    let activeLines = lines;
    if (startIdx !== -1) {
      removed.push(...activeLines.slice(0, startIdx));
      removed.push(...activeLines.slice(startIdx + 1, startIdx + 4));
      activeLines = [activeLines[startIdx], ...activeLines.slice(startIdx + 4)];
    }

    const trimmed = [];
    for (let line of activeLines) {
      if (line.trim().toLowerCase().startsWith("reference list")) {
        removed.push(...activeLines.slice(activeLines.indexOf(line)));
        break;
      }
      trimmed.push(line);
    }
    activeLines = trimmed;

    const clearHeaders = [
      "Target Group of Project & Rational",
      "Proposed Ideas & Rationale",
      "Aim(s) of Project",
    ];
    activeLines = activeLines.map(line => {
      if (clearHeaders.some(h => line.trim().toLowerCase().startsWith(h.toLowerCase()))) {
        removed.push(line);
        return "";
      }
      return line;
    });

    activeLines = activeLines.map(line => {
      if (line.trim().toLowerCase().startsWith("fig.")) {
        removed.push(line);
        return "";
      }
      return line;
    });

    activeLines = activeLines.map(line => removeSpecialBrackets(line, removed));

    const final = activeLines.filter(line => {
      if (!/[.?!]/.test(line)) {
        removed.push(line);
        return false;
      }
      return true;
    });

    return {
      original: input,
      processed: final.join('\n').trim(),
      cut: removed.join('\n').trim()
    };
  }

  function handleProcess() {
    const input = document.getElementById("inputText").value;

    // Save to localStorage
    localStorage.setItem("userInputText", input);

    const { original, processed, cut } = processText(input);

    document.getElementById("originalCount").innerHTML = `<strong>Original Words:</strong> ${countWords(original)}`;
    document.getElementById("processedCount").innerHTML = `<strong>Processed Words:</strong> ${countWords(processed)}`;
    document.getElementById("cutCount").innerHTML = `<strong>Cut Words:</strong> ${countWords(cut)}`;

    document.getElementById("processedOutput").innerText = processed;
    document.getElementById("cutOutput").innerText = cut;
  }

  // Restore text on page load
  window.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem("userInputText");
    if (saved) {
      document.getElementById("inputText").value = saved;
      handleProcess();
    }

    // Auto-save every keystroke
    document.getElementById("inputText").addEventListener("input", () => {
      localStorage.setItem("userInputText", document.getElementById("inputText").value);
    });
  });
</script>


</body>
</html>
